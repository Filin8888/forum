<!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç—ñ–≤ -->
{% extends "base.html" %}
{% block title %}–ì–æ–ª–æ–≤–Ω–∞ ‚Äî MiniForum{% endblock %}
{% block content %}
<div class="toolbar">
  <form class="search" action="{{ url_for('main.index') }}" method="get">
    <input name="q" placeholder="–ü–æ—à—É–∫ –ø–æ —Ç–µ–º—ñ –∞–±–æ –∞–≤—Ç–æ—Ä—É..." value="{{ request.args.get('q','') }}">
    <button>üîé</button>
  </form>

  {% if current_user.is_authenticated %}
    <a href="{{ url_for('main.create_post') }}" class="btn">‚ûï –ù–æ–≤–∞ —Ç–µ–º–∞</a>
  {% endif %}
</div>

<table class="posts-table">
  <thead>
    <tr>
      <th>–¢–µ–º–∞</th>
      <th>–ê–≤—Ç–æ—Ä</th>
      <th>–í—ñ–¥–ø–æ–≤—ñ–¥—ñ</th>
      <th>
        –û—Å—Ç–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
        <a class="sort" href="{{ url_for('main.index', sort='last_activity', order='asc') }}">‚ñ≤</a>
        <a class="sort" href="{{ url_for('main.index', sort='last_activity', order='desc') }}">‚ñº</a>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for post in posts %}
    <tr>
      <td class="post-title">
        <a href="{{ url_for('main.post_detail', post_id=post.id) }}">{{ post.title }}</a>
          <div class="post">
            <p class="content">{{ post.content }}</p>
            <small>–ê–≤—Ç–æ—Ä: {{ post.author.username }}</small>
                <!-- –∫–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
            {% if current_user.is_authenticated and (current_user.role in ['admin', 'moderator'] or current_user.id == post.user_id) %}
              <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST">
                <button type="submit">–í–∏–¥–∞–ª–∏—Ç–∏</button>
              </form>
            {% endif %}
          </div>
        <div class="tags">
          {% for t in post.tags %}
            <span class="tag">{{ t.name }}</span>
          {% endfor %}
        </div>
      </td>
      <td>{{ post.author.username }}</td>
      <td>{{ post.comments|length }}</td>
      <td>{{ post.last_activity.strftime('%Y-%m-%d %H:%M') if post.last_activity else '' }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">–ù–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
